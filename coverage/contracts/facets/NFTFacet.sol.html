<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/facets/NFTFacet.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">all files</a> / <a href="index.html">contracts/facets/</a> NFTFacet.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>42/42</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>34/34</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>20/20</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>60/60</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">297×</span>
<span class="cline-any cline-yes">297×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">61×</span>
<span class="cline-any cline-yes">61×</span>
<span class="cline-any cline-yes">61×</span>
<span class="cline-any cline-yes">61×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">61×</span>
<span class="cline-any cline-yes">61×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">37×</span>
<span class="cline-any cline-yes">37×</span>
<span class="cline-any cline-yes">33×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">73×</span>
<span class="cline-any cline-yes">72×</span>
<span class="cline-any cline-yes">72×</span>
<span class="cline-any cline-yes">71×</span>
<span class="cline-any cline-yes">71×</span>
<span class="cline-any cline-yes">71×</span>
<span class="cline-any cline-yes">71×</span>
<span class="cline-any cline-yes">71×</span>
<span class="cline-any cline-yes">71×</span>
<span class="cline-any cline-yes">71×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">24×</span>
<span class="cline-any cline-yes">22×</span>
<span class="cline-any cline-yes">22×</span>
<span class="cline-any cline-yes">22×</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;
&nbsp;
import {LibDiamond} from "../LibDiamond.sol";
&nbsp;
library LibNFT {
    bytes32 constant NFT_STORAGE_POSITION = keccak256("diamond.storage.nft");
&nbsp;
    struct NFTStorage {
        string name;
        string symbol;
        uint256 tokenIds;
        mapping(uint256 =&gt; address) owners;
        mapping(uint256 =&gt; string) tokenURIs;
        mapping(address =&gt; uint256) balances;
        mapping(address =&gt; mapping(address =&gt; bool)) operatorApprovals;
        mapping(uint256 =&gt; address) tokenApprovals;
        uint256 MAX_SUPPLY;
    }
&nbsp;
    function nftStorage() internal pure returns (NFTStorage storage ns) {
        bytes32 position = NFT_STORAGE_POSITION;
        assembly { ns.slot := position }
    }
&nbsp;
    function init(string memory _name, string memory _symbol, uint256 _maxSupply) internal {
        NFTStorage storage ns = nftStorage();
        ns.name = _name;
        ns.symbol = _symbol;
        ns.MAX_SUPPLY = _maxSupply;
    }
}
&nbsp;
contract NFTFacet {
    event NFTMinted(uint256 indexed tokenId, address indexed owner, string tokenURI);
    event NFTBurned(uint256 indexed tokenId, address indexed owner);
&nbsp;
    function initNFT(string memory _name, string memory _symbol, uint256 _maxSupply) external {
        LibDiamond.enforceIsContractOwner();
        LibNFT.init(_name, _symbol, _maxSupply);
    }
&nbsp;
    function name() external view returns (string memory) {
        return LibNFT.nftStorage().name;
    }
&nbsp;
    function symbol() external view returns (string memory) {
        return LibNFT.nftStorage().symbol;
    }
&nbsp;
    function ownerOf(uint256 tokenId) public view returns (address) {
        address owner = LibNFT.nftStorage().owners[tokenId];
        require(owner != address(0), "ERC721: invalid token ID");
        return owner;
    }
&nbsp;
    function balanceOf(address owner) external view returns (uint256) {
        require(owner != address(0), "ERC721: address zero is not a valid owner");
        return LibNFT.nftStorage().balances[owner];
    }
&nbsp;
    function tokenURI(uint256 tokenId) external view returns (string memory) {
        require(LibNFT.nftStorage().owners[tokenId] != address(0), "ERC721Metadata: URI set of nonexistent token");
        return LibNFT.nftStorage().tokenURIs[tokenId];
    }
&nbsp;
    function mintNFT(address recipient, string memory _tokenURI) external returns (uint256) {
        LibDiamond.enforceIsContractOwner();
        LibNFT.NFTStorage storage ns = LibNFT.nftStorage();
        require(ns.tokenIds &lt; ns.MAX_SUPPLY, "Max supply reached");
        ns.tokenIds++;
        uint256 newItemId = ns.tokenIds;
        ns.owners[newItemId] = recipient;
        ns.balances[recipient]++;
        ns.tokenURIs[newItemId] = _tokenURI;
        emit NFTMinted(newItemId, recipient, _tokenURI);
        return newItemId;
    }
&nbsp;
    function transferFrom(address from, address to, uint256 tokenId) external {
        _transferFrom(msg.sender, from, to, tokenId);
    }
&nbsp;
    function setApprovalForAll(address operator, bool approved) external {
        LibNFT.NFTStorage storage ns = LibNFT.nftStorage();
        ns.operatorApprovals[msg.sender][operator] = approved;
    }
&nbsp;
    function isApprovedForAll(address owner, address operator) external view returns (bool) {
        return LibNFT.nftStorage().operatorApprovals[owner][operator];
    }
&nbsp;
    function approve(address to, uint256 tokenId) external {
        LibNFT.NFTStorage storage ns = LibNFT.nftStorage();
        address owner = ns.owners[tokenId];
        require(owner != address(0), "ERC721: invalid token ID");
        require(msg.sender == owner || ns.operatorApprovals[owner][msg.sender], "ERC721: caller is not token owner or approved");
        ns.tokenApprovals[tokenId] = to;
    }
&nbsp;
    function getApproved(uint256 tokenId) external view returns (address) {
        return LibNFT.nftStorage().tokenApprovals[tokenId];
    }
&nbsp;
    function safeTransferFrom(address from, address to, uint256 tokenId) external {
        // Minimal safeTransferFrom: call internal transfer to preserve msg.sender checks
        _transferFrom(msg.sender, from, to, tokenId);
    }
&nbsp;
    function _transferFrom(address operator, address from, address to, uint256 tokenId) internal {
        require(to != address(0), "ERC721: transfer to the zero address");
        LibNFT.NFTStorage storage ns = LibNFT.nftStorage();
        address owner = ns.owners[tokenId];
        require(owner == from, "ERC721: transfer from incorrect owner");
        require(operator == owner || ns.operatorApprovals[owner][operator] || ns.tokenApprovals[tokenId] == operator, "ERC721: caller is not token owner or approved");
&nbsp;
        // clear approval
        if (ns.tokenApprovals[tokenId] != address(0)) {
            ns.tokenApprovals[tokenId] = address(0);
        }
&nbsp;
        ns.owners[tokenId] = to;
        ns.balances[from]--;
        ns.balances[to]++;
    }
&nbsp;
    function tokenIds() external view returns (uint256) {
        return LibNFT.nftStorage().tokenIds;
    }
&nbsp;
    function setTokenURI(uint256 tokenId, string memory newTokenURI) external {
        LibDiamond.enforceIsContractOwner();
        require(LibNFT.nftStorage().owners[tokenId] != address(0), "ERC721Metadata: URI set of nonexistent token");
        LibNFT.nftStorage().tokenURIs[tokenId] = newTokenURI;
    }
&nbsp;
    function burn(uint256 tokenId) external {
        LibNFT.NFTStorage storage ns = LibNFT.nftStorage();
        address owner = ns.owners[tokenId];
        require(owner == msg.sender || ns.operatorApprovals[owner][msg.sender] || ns.tokenApprovals[tokenId] == msg.sender, "ERC721: caller is not token owner or approved");
        delete ns.owners[tokenId];
        delete ns.tokenURIs[tokenId];
        ns.balances[owner]--;
        emit NFTBurned(tokenId, owner);
    }
&nbsp;
    function MAX_SUPPLY() external view returns (uint256) {
        return LibNFT.nftStorage().MAX_SUPPLY;
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue Nov 25 2025 22:52:11 GMT+0100 (hora estándar de Europa central)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
